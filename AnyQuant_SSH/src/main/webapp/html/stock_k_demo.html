<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

    <link rel="shortcut icon" href="/image/shoot_cut.png">
    <!-- jQuery -->
    <script type="text/javascript" charset="utf8" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>stock_k_demo</title>
    <link rel="stylesheet" href="../css/stockOHLC/style.css" type="text/css">

    <script src="../js/stockOHLC/amcharts.js" type="text/javascript"></script>
    <script src="../js/stockOHLC/serial.js" type="text/javascript"></script>
    <script src="../js/stockOHLC/amstock.js" type="text/javascript"></script>

    <script>
        AmCharts.ready(function () {
            generateChartData();
//            createStockChart();
        });

        var chartData = [];

        function generateChartData() {
            $.ajax({
                url:"/Stock/getStockDataListByTime",
                type:'get',
                data:{code:'sz002173',start:'2010-01-01',end:'2016-01-31'},
                success:function (data) {
                    var dataLength = data.length;

                    for(var i=0;i<dataLength;i++){
                        var newDate=new Date(data[i].date).getTime();
                        var open = data[i].open;
                        var close =data[i].close;
                        var low=data[i].low;
                        var high=data[i].high;
                        var volume =data[i].turnoverVol;

                        var value = 100;
//                        alert("date:"+newDate+"   open:"+open+"  close:"+close+"  low"+low+"  high:"+high+"  volume:"+volume+"  value"+value);
                        chartData[i] = ({
                            date: newDate,
                            open: open,
                            close: close,
                            high: high,
                            low: low,
                            volume: volume,
                            value: value
                        });
//                        alert("done");
                    }
                    createStockChart();
                },
                error:function () {
                    alert("Stock_k_demo.html!wrong!");
                }

            });


        }

        function createStockChart() {
            var chart = new AmCharts.AmStockChart();
            var dataSet = new AmCharts.DataSet();
            dataSet.fieldMappings = [{
                fromField: "open",
                toField: "open"
            }, {
                fromField: "close",
                toField: "close"
            }, {
                fromField: "high",
                toField: "high"
            }, {
                fromField: "low",
                toField: "low"
            }, {
                fromField: "volume",
                toField: "volume"
            }, {
                fromField: "value",
                toField: "value"
            }];
            dataSet.color = "#FFFF00";
            dataSet.dataProvider = chartData;
            dataSet.title = "k线图";
            dataSet.categoryField = "date";

            var dataSet2 = new AmCharts.DataSet();
            dataSet2.fieldMappings = [{
                fromField: "open",
                toField: "open"
            }];
            dataSet2.color = "#fac314";
            dataSet2.dataProvider = chartData;
            dataSet2.compared = true;
            dataSet2.title = "市值";
            dataSet2.categoryField = "date";

            chart.dataSets = [dataSet, dataSet2];

            // PANELS ///////////////////////////////////////////
            var stockPanel = new AmCharts.StockPanel();
            stockPanel.title = "Value";
            stockPanel.showCategoryAxis = false;
            stockPanel.percentHeight = 70;

            var valueAxis = new AmCharts.ValueAxis();
            valueAxis.dashLength = 5;
            stockPanel.addValueAxis(valueAxis);

            stockPanel.categoryAxis.dashLength = 5;

            // graph of first stock panel
            var graph = new AmCharts.StockGraph();
            graph.type = "candlestick";
            graph.openField = "open";
            graph.closeField = "close";
            graph.highField = "high";
            graph.lowField = "low";
            graph.valueField = "open"+"close";
            graph.lineColor = "#00CD00";
            graph.fillColors = "#00CD00";
            graph.negativeLineColor = "#db4c3c";
            graph.negativeFillColors = "#db4c3c";
            graph.proCandlesticks = true;
            graph.fillAlphas = 1;
            graph.useDataSetColors = false;
            graph.comparable = true;
            graph.compareField = "value";
            graph.showBalloon = true;
            stockPanel.addStockGraph(graph);

            var stockLegend = new AmCharts.StockLegend();
            stockLegend.valueTextRegular = undefined;
            stockLegend.periodValueTextComparing = "[[percents.value.open]]  [[percents.value.close]]";
            stockPanel.stockLegend = stockLegend;

            var chartCursor = new AmCharts.ChartCursor();
            chartCursor.valueLineEnabled = true;
            chartCursor.valueLineAxis = valueAxis;
            stockPanel.chartCursor = chartCursor;

            var stockPanel2 = new AmCharts.StockPanel();
            stockPanel2.title = "成交量";
            stockPanel2.percentHeight = 50;
            stockPanel2.marginTop = 1;
            stockPanel2.showCategoryAxis = true;

            var valueAxis2 = new AmCharts.ValueAxis();
            valueAxis2.dashLength = 5;
            stockPanel2.addValueAxis(valueAxis2);

            stockPanel2.categoryAxis.dashLength = 5;

            var graph2 = new AmCharts.StockGraph();
            graph2.valueField = "volume";
            graph2.type = "column";
            graph2.showBalloon = true;
            graph2.fillAlphas = 1;
            stockPanel2.addStockGraph(graph2);

            var legend2 = new AmCharts.StockLegend();
            legend2.markerType = "none";
            legend2.markerSize = 0;
            legend2.labelText = "";
            legend2.periodValueTextRegular = "[[value.close]]";
            stockPanel2.stockLegend = legend2;

            var chartCursor2 = new AmCharts.ChartCursor();
            chartCursor2.valueLineEnabled = true;
            chartCursor2.valueLineAxis = valueAxis2;
            stockPanel2.chartCursor = chartCursor2;

            chart.panels = [stockPanel, stockPanel2];


            // OTHER SETTINGS ////////////////////////////////////
            var sbsettings = new AmCharts.ChartScrollbarSettings();
            sbsettings.graph = graph;
            sbsettings.graphType = "line";
            sbsettings.usePeriod = "WW";
            sbsettings.updateOnReleaseOnly = false;
            chart.chartScrollbarSettings = sbsettings;


            // PERIOD SELECTOR ///////////////////////////////////
            var periodSelector = new AmCharts.PeriodSelector();
            periodSelector.position = "bottom";
            periodSelector.periods = [{
                period: "DD",
                count: 10,
                label: "10 days"
            }, {
                period: "MM",
                selected: true,
                count: 1,
                label: "1 month"
            }, {
                period: "YYYY",
                count: 1,
                label: "1 year"
            }, {
                period: "YTD",
                label: "YTD"
            }, {
                period: "MAX",
                label: "MAX"
            }];
            chart.periodSelector = periodSelector;

            chart.write('chartdiv');
        }


    </script>
</head>
<body >
<div id="chartdiv" style="width:80%; height:400px;background-color:#FFFFFF"></div>
</body>

</html>