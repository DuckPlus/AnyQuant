<!--author:dsn-->
<!--date:2016-5-11-->
<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
	<!--tab上的小图标-->
	<link rel="shortcut icon" href="/image/shoot_cut.png">
	<link rel="stylesheet" href="../css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="../css/style.css"> <!-- Resource style -->
	<script src="../js/modernizr.js"></script> <!-- Modernizr -->


	<!--jQuery dependencies-->
	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/base/jquery-ui.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<!--PQ Grid files-->
	<link rel="stylesheet" href="../css/pqgrid.min.css" />
	<script src="../js/pqgrid.min.js"></script>
	<!--PQ Grid Office theme-->
	<link rel="stylesheet" href="../css/pqgrid.css" />

    <!--都是外面的css-->
	<!--fonts-->
	<link href='https://fonts.googleapis.com/css?family=Titillium+Web:200' rel='stylesheet' type='text/css'>
	<!-- jQuery -->
	<script type="text/javascript" charset="utf8" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<!-- DataTables -->
	<script type="text/javascript" charset="utf8" src="http://cdn.datatables.net/1.10.7/js/jquery.dataTables.js"></script>
    <!--<%&#45;&#45;表头css???奇葩&#45;&#45;%>-->
	<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
	<!--<%&#45;&#45;tbody css&#45;&#45;%>-->
	<link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.7/css/jquery.dataTables.css">
	<link  rel="stylesheet" type="text/css" href ="http://cdn.datatables.net/plug-ins/28e7751dbec/integration/jqueryui/dataTables.jqueryui.css">
	<script type = "text/javascript" src = "http://cdn.datatables.net/plug-ins/28e7751dbec/integration/jqueryui/dataTables.jqueryui.js"></script>
	<link rel="stylesheet" type="text/css" href="/css/StockList.css">
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<link href='https://fonts.googleapis.com/css?family=Titillium+Web:200' rel='stylesheet' type='text/css'>
	<!--动画的css支持-->
	<link rel="stylesheet" type="text/css" href="/css/animate.css">


	<title>Optional</title>
</head>
<body>
<nav class="cd-side-navigation">
	<ul>
		<li>
			<a href="#0" data-menu="StockList">
				<svg class="nc-icon outline" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24"><g transform="translate(0, 0)"> <polygon fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" points="12,2 3,10 3,23 9,23 9,16 15,16 15,23 21,23 21,10 " stroke-linejoin="miter"></polygon> </g></svg>
				股票列表
			</a>
		</li>
		<li>
			<a href="#0" data-menu="BenchMark">
				<svg class="nc-icon outline" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24"><g transform="translate(0, 0)"> <polyline data-color="color-2" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" points=" 16,7 16,2 8,2 8,7 " stroke-linejoin="miter"></polyline> <rect x="1" y="7" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="22" height="15" stroke-linejoin="miter"></rect> <line fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" x1="5" y1="7" x2="5" y2="22" stroke-linejoin="miter"></line> <line fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" x1="19" y1="7" x2="19" y2="22" stroke-linejoin="miter"></line> </g></svg>
				大盘列表
			</a>
		</li>
		<li>
			<a href="#0" class="selected" data-menu="OptionalList">
				<svg class="nc-icon outline" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24"><g transform="translate(0, 0)"> <rect x="1" y="1" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="22" height="22" stroke-linejoin="miter"></rect> <rect data-color="color-2" x="5" y="5" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="5" height="5" stroke-linejoin="miter"></rect> <rect data-color="color-2" x="14" y="5" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="5" height="5" stroke-linejoin="miter"></rect> <rect data-color="color-2" x="5" y="14" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="5" height="5" stroke-linejoin="miter"></rect> <rect data-color="color-2" x="14" y="14" fill="none" stroke="#4a5261" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" width="5" height="5" stroke-linejoin="miter"></rect> </g></svg>
				自选股
			</a>
		</li>
	</ul>
</nav> <!-- .cd-side-navigation -->

	<main class="cd-main">
			<section class="cd-section OptionalList visible">
				<header>

					<div class="cd-title">
						<h2>自选股</h2>
						<span>OptionalStock</span>

					</div>
				</header>
				<div class="tab-container">
					<div class="tab-wrapper">
						<!--tab section 1-->
						<input type="radio" name="tab-radio" class="tab-radio" id="tab-radio-1" checked>
						<label for="tab-radio-1" class="tab-handler tab-handler-1">自选列表</label>
						<div class="tab-content tab-content-1">

							<script>
								function changeHeight() {
									document.getElementById("curtain").style.height=window.screen.height;
								}
								window.onload=changeHeight;
							</script>

							<div id="stock_list_container" class="stock_list_pane">
								<table id="stock_list" class="display">
									<thead>
									<tr>
										<th>股票名称</th>
										<th>股票代码</th>
										<th>开盘价</th>
										<th>最高价</th>
										<th>最低价</th>
										<th>收盘价</th>
										<th>成交量</th>
										<th>换手率</th>
									</tr>

									</thead>
									<tbody>
									</tbody>

									<tfoot>
									</tfoot>

								</table>
								<!--<button class="button" id="button">Select Row</button>-->
							</div>

							<script>
								var allStock;
								$(document).ready(function () {
											$.ajax({
												type:'post',
												url:'/Optional/get',
												contentType:'application/json;charset=utf-8',
												success:function (data){
//                alert("success");
													initTable(data);
												},
												error:function () {
													alert("请求失败");
												}
											});
										}
								);

								/*
								 *初始化table的方法,包括样式的配置
								 */
								function initTable(allStock) {
									var table = $('#stock_list').DataTable( {

										data:allStock,
										columns:[
											{data:'name'},
											{data:'code'},
											{data:'open'},
											{data:'high'},
											{data:'low'},
											{data:'close'},
											{data:'turnoverVol'},
											{data:'changeRate'}
										],
//                "scrollY":"500px",
//                "scrollY": "50%",
//                "scrollCollapse": true,
//                "padding":false,
										/*
										 *自适应宽度 默认true 关闭可提升性能,同时方便管理布局
										 */
										"autoWidth":false,
										"columnDefs": [
											// 将name列变为红色
											{
												"targets": [0], // 目标列位置，下标从0开始
												"data": "name", // 数据列名
												"render": function(data, type, full) { // 返回自定义内容
													return "<span style='color:red;'>" + data + "</span>";
												}
											}
										],
										//国际化
										"oLanguage": {
											"sProcessing": "疯狂加载数据中.",
											"sLengthMenu": "每页显示 _MENU_ 条记录",
											"sZeroRecords": "抱歉， 没有找到",
											"sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
											"sInfoEmpty": "没有数据",
											"sInfoFiltered": "(从 _MAX_ 条数据中检索)",
											"sZeroRecords": "没有检索到数据",
											"sSearch": "模糊查询:  ",
											"oPaginate": {
												"sFirst": "首页",
												"sPrevious": "前一页",
												"sNext": "后一页",
												"sLast": "尾页"
											}
										},


									} );

//以下是关于选择行的代码

									$('#stock_list tbody').on( 'click', 'tr', function () {
//                if ( $(this).hasClass('selected') ) {
//                    $(this).removeClass('selected');
//                }
//                else {
										table.$('tr.selected').removeClass('selected');
										$(this).addClass('selected');
										var selected_row = table.row('.selected').index();
										var value = table.cell(selected_row,1).data();
										showStockChart(value);
//                }
									} );
								}
								//    initTable();

							</script>

							<div id="duck_stock_chart" style="background-color: #2b542c;margin-top: 0px;height: 400px;">



							</div>
							<script>
								function showStockChart(stockCode) {
									$.ajax({
										url:"/Stock//getStockDataListByOffset",

										type:'get',
										data:{code:stockCode,offset:'-30',end:''},
										success:function (data) {
											var ohlc = [],
													volume = [],
													dataLength = data.length,
											// set the allowed units for data grouping
													groupingUnits = [[
														'week',                         // unit name
														[1]                             // allowed multiples
													], [
														'month',
														[1, 2, 3, 4, 6]
													]],

													i = 0;
											for (i; i < dataLength; i += 1) {

												ohlc.push([
													new Date(data[i].date).getTime(),
													data[i].open,
													data[i].high,
													data[i].low,
													data[i].close
												]);
//                alert("loaded ohlc: open"+data[i].open+"high"+data[i].high+"low"+data[i].low+"close"+data[i].close);
												volume.push([
//                    data[i][0], // the date
//                    data[i][5] // the volume
													new Date(data[i].date).getTime(),
													data[i].turnoverVol
												]);
//                alert("loaded volume: date:"+new Date(data[i].date).getTime()+ "vol 1000");
											}


											// create the chart
											$('#duck_stock_chart').highcharts('StockChart', {

												plotOptions: {
													candlestick: {
														color: 'green',
														upColor: 'red'
													}
												},
												rangeSelector: {
													selected: 1
												},

												title: {
													text: stockCode+' AAPL Historical'
												},

												yAxis: [{
													labels: {
														align: 'right',
														x: -3
													},
													title: {
														text: 'OHLC'
													},
													height: '60%',
													lineWidth: 2
												}, {
													labels: {
														align: 'right',
														x: -3
													},
													title: {
														text: 'Volume'
													},
													top: '65%',
													height: '35%',
													offset: 0,
													lineWidth: 2
												}],

												series: [{
													type: 'candlestick',
													name: 'AAPL',
													data: ohlc,
													dataGrouping: {
														units: groupingUnits
													}
												}, {
													type: 'column',
													name: 'Volume',
													data: volume,
													yAxis: 1,
													dataGrouping: {
														units: groupingUnits
													}
												}]
											});
										},
										error:function () {
											alert("Optional_table.html!wrong!");
										}

									});

								}
							</script>
							<script>if(document.getElementById("tab-radio-1").checked==true){
								//TODO 动态初始化效果
							}</script>
							<!--<object type="text/x-scriptlet" data="Optional_table.html" width=1200 height=1000></object>-->
						</div>
						<!--tab section 2-->
						<input type="radio" name="tab-radio" class="tab-radio" id="tab-radio-2">
						<label for="tab-radio-2" class="tab-handler tab-handler-2">板块分布</label>
						<div class="tab-content tab-content-2">
							<object type="text/x-scriptlet" data="Optional_board_distribution.html" width=1200 height=1000></object>
						</div>
						<!--tab section 3-->
						<input type="radio" name="tab-radio" class="tab-radio" id="tab-radio-3">
						<label for="tab-radio-3" class="tab-handler tab-handler-3">地域分布</label>
						<div class="tab-content tab-content-3">
							<object type="text/x-scriptlet" data="Optional_region_distribution.html" width=1200 height=1000></object>
						</div><!--tab section 4-->
						<input type="radio" name="tab-radio" class="tab-radio" id="tab-radio-4">
						<label for="tab-radio-4" class="tab-handler tab-handler-4">自选比较</label>
						<div class="tab-content tab-content-4">
							<object type="text/x-scriptlet" data="Optional_self_compare.html" width=1200 height=1000></object>
						</div>
					</div>
				</div>
				.
            </section>
	</main>
<div id="cd-loading-bar" data-scale="1" class="OptionalList"></div> <!-- lateral loading bar -->
<script src="../js/jquery-2.1.4.js"></script>
<script src="../js/velocity.min.js"></script>
<script src="../js/main.js"></script> <!-- Resource jQuery -->
</body>
</html>